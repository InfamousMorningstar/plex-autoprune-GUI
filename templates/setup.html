{% extends "base.html" %}

{% block title %}Setup Wizard{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 32px auto;">
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 32px;">
        <div style="color: var(--text-muted); font-size: 11px; margin-bottom: 8px;">$ guardian --setup --interactive</div>
        <h1 style="color: var(--brand-cyan); font-size: 24px; font-weight: normal; margin: 0 0 8px 0;">Guardian Setup Wizard</h1>
        <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">Configure your Plex user management system</p>
    </div>

    <!-- Progress Steps -->
    <div class="card" style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; padding: 24px;">
            <div class="setup-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Plex</div>
            </div>
            <div class="setup-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Tautulli</div>
            </div>
            <div class="setup-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Email</div>
            </div>
            <div class="setup-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Discord</div>
            </div>
            <div class="setup-step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Settings</div>
            </div>
            <div class="setup-step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-label">Complete</div>
            </div>
        </div>
    </div>

    <!-- Setup Form -->
    <form id="setupForm">
        <!-- Step 1: Plex Configuration -->
        <div class="setup-content card" data-step="1">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 1: Plex Configuration</h2>
            </div>
            <div class="card-body">
                <div id="plexAuthenticatedSection" style="display: none;">
                    <div class="alert alert-success" style="margin-bottom: 24px;">
                        <strong>‚úì Already Authenticated!</strong><br>
                        You're signed in with your Plex account. Server details configured automatically.
                    </div>
                    
                    <div class="form-group">
                        <label>PLEX_TOKEN</label>
                        <input type="password" name="PLEX_TOKEN" readonly style="background: var(--term-surface-2); opacity: 0.7;">
                        <div style="color: var(--brand-success); font-size: 11px; margin-top: 4px;">‚úì Retrieved via Plex OAuth</div>
                    </div>

                    <div class="form-group">
                        <label>SERVER_NAME</label>
                        <input type="text" name="PLEX_SERVER_NAME" readonly style="background: var(--term-surface-2); opacity: 0.7;">
                        <div style="color: var(--brand-success); font-size: 11px; margin-top: 4px;">‚úì Auto-detected from account</div>
                    </div>
                </div>

                <div id="plexManualSection">
                    <div class="form-group">
                        <label>PLEX_TOKEN *</label>
                        <input type="password" name="PLEX_TOKEN_MANUAL" required>
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">
                            Get your token: Plex Settings ‚Üí Network ‚Üí Show Advanced ‚Üí X-Plex-Token
                        </div>
                    </div>

                    <div class="form-group">
                        <label>SERVER_NAME</label>
                        <input type="text" name="PLEX_SERVER_NAME_MANUAL" placeholder="My Plex Server">
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Optional: Display name for your server</div>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="testPlex()">Test Connection</button>
                </div>

                <div id="plexStatus" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Step 2: Tautulli Configuration -->
        <div class="setup-content card" data-step="2" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 2: Tautulli Configuration</h2>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                        <label>TAUTULLI_URL *</label>
                        <input type="url" name="TAUTULLI_URL" required placeholder="http://192.168.1.100:8181">
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Full URL to your Tautulli instance</div>
                    </div>

                    <div class="form-group">
                        <label>PORT</label>
                        <input type="number" value="8181" readonly style="background: var(--term-surface-2); opacity: 0.7;">
                    </div>
                </div>

                <div class="form-group">
                    <label>API_KEY *</label>
                    <input type="password" name="TAUTULLI_API_KEY" required>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">
                        Tautulli Settings ‚Üí Web Interface ‚Üí API Key
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="testTautulli()">Test Connection</button>
                <div id="tautulliStatus" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Step 3: Email Configuration -->
        <div class="setup-content card" data-step="3" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 3: Email Configuration</h2>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>SMTP_SERVER *</label>
                        <input type="text" name="SMTP_HOST" value="smtp.gmail.com" required>
                    </div>

                    <div class="form-group">
                        <label>PORT *</label>
                        <input type="number" name="SMTP_PORT" value="587" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>EMAIL_ADDRESS *</label>
                    <input type="email" name="SMTP_USERNAME" required>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Gmail address to send from</div>
                </div>

                <div class="form-group">
                    <label>APP_PASSWORD *</label>
                    <input type="password" name="SMTP_PASSWORD" required>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">
                        Gmail app password (not your regular password) - 
                        <a href="https://support.google.com/accounts/answer/185833" target="_blank" style="color: var(--brand-cyan);">Get one here</a>
                    </div>
                </div>

                <div class="form-group">
                    <label>FROM_NAME</label>
                    <input type="text" name="SMTP_FROM" placeholder='"Plex Admin" <you@gmail.com>'>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Display name in sent emails</div>
                </div>

                <div class="form-group">
                    <label>ADMIN_EMAIL *</label>
                    <input type="email" name="ADMIN_EMAIL" required>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Where to send admin notifications</div>
                </div>

                <button type="button" class="btn btn-primary" onclick="testEmail()">Send Test Email</button>
                <div id="emailStatus" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Step 4: Discord (Optional) -->
        <div class="setup-content card" data-step="4" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 4: Discord Integration (Optional)</h2>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>WEBHOOK_URL</label>
                    <input type="url" name="DISCORD_WEBHOOK" placeholder="https://discord.com/api/webhooks/...">
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">
                        Optional: Discord webhook for real-time notifications
                    </div>
                </div>

                <div class="form-group">
                    <label>YOUR_DISCORD_PROFILE</label>
                    <input type="url" name="LINK_DISCORD" placeholder="https://discord.com/users/123456789">
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Optional: Link to your Discord profile</div>
                </div>

                <button type="button" class="btn btn-primary" onclick="testDiscord()">Send Test Message</button>
                <div id="discordStatus" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Step 5: Settings -->
        <div class="setup-content card" data-step="5" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 5: Thresholds & Settings</h2>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>WARNING_THRESHOLD (days) *</label>
                        <input type="number" name="WARN_DAYS" value="27" min="1" required>
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Send warning after this many days of inactivity</div>
                    </div>

                    <div class="form-group">
                        <label>REMOVAL_THRESHOLD (days) *</label>
                        <input type="number" name="KICK_DAYS" value="30" min="1" required>
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Remove user after this many days</div>
                    </div>

                    <div class="form-group">
                        <label>NEW_USER_CHECK (seconds)</label>
                        <input type="number" name="CHECK_NEW_USERS_SECS" value="120" min="10">
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">How often to check for new users</div>
                    </div>

                    <div class="form-group">
                        <label>INACTIVITY_CHECK (seconds)</label>
                        <input type="number" name="CHECK_INACTIVITY_SECS" value="1800" min="60">
                        <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">How often to check user activity</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>PROTECTED_USERNAMES</label>
                    <textarea name="VIP_NAMES" rows="3" placeholder="friend1,family_member,bestfriend"></textarea>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">Comma-separated list of usernames to protect from auto-removal</div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 12px; background: var(--term-surface-2); border: 1px solid var(--term-border); border-radius: 4px;">
                        <input type="checkbox" name="DRY_RUN" id="dryRunCheckbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <div>
                            <div style="font-weight: bold; color: var(--text-primary);">DRY_RUN Mode</div>
                            <div style="color: var(--text-muted); font-size: 11px; margin-top: 4px;">
                                Recommended for testing - logs actions without executing them
                            </div>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Step 6: Import Existing Users -->
        <div class="setup-content card" data-step="6" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Step 6: Import Existing Users (Optional)</h2>
            </div>
            <div class="card-body">
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Import all existing Plex users and mark them as welcomed. This prevents sending welcome emails to users who are already on your server.
                </p>
                
                <div id="importStatus" style="display: none; padding: 16px; border-radius: 4px; margin-bottom: 16px;"></div>
                
                <div id="importPreview" style="display: none; margin-bottom: 24px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 12px;">Users to Import:</h4>
                    <div id="importUserList" style="max-height: 300px; overflow-y: auto; background: var(--term-surface-2); border: 1px solid var(--term-border); border-radius: 4px; padding: 12px;">
                        <!-- Users will be listed here -->
                    </div>
                </div>

                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button type="button" class="btn btn-primary" onclick="previewImportUsers()">
                        üìã Preview Users
                    </button>
                    <button type="button" class="btn btn-success" onclick="importExistingUsers()" id="importBtn" disabled>
                        ‚úì Import All Users
                    </button>
                    <button type="button" class="btn" onclick="skipImport()">
                        Skip This Step ‚Üí
                    </button>
                </div>

                <div style="margin-top: 24px; padding: 12px; background: var(--term-surface-2); border-left: 3px solid var(--brand-info); border-radius: 4px;">
                    <div style="font-weight: bold; color: var(--brand-info); margin-bottom: 8px;">‚ÑπÔ∏è Note:</div>
                    <div style="color: var(--text-muted); font-size: 11px; line-height: 1.6;">
                        ‚Ä¢ If you skip this step, the daemon will automatically discover and welcome new users over time<br>
                        ‚Ä¢ Imported users will not receive welcome emails<br>
                        ‚Ä¢ You can always manually manage users later from the Users page
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 7: Complete -->
        <div class="setup-content card" data-step="7" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">‚ñ∫ Setup Complete!</h2>
            </div>
            <div class="card-body" style="text-align: center; padding: 48px 24px;">
                <div style="font-size: 64px; margin-bottom: 24px;">‚úì</div>
                <h3 style="color: var(--brand-success); font-size: 20px; margin-bottom: 16px;">Configuration Saved Successfully</h3>
                <p style="color: var(--text-secondary); margin-bottom: 32px;">
                    Your Guardian instance is ready to start managing Plex users automatically.
                </p>
                <button type="button" class="btn btn-success btn-lg" onclick="completeSetup()">
                    Go to Dashboard ‚Üí
                </button>
            </div>
        </div>
    </form>

    <!-- Navigation Buttons -->
    <div class="card" style="margin-top: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
            <button type="button" class="btn" id="prevBtn" onclick="previousStep()" style="display: none;">
                ‚Üê Previous
            </button>
            <div style="flex: 1;"></div>
            <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                Next ‚Üí
            </button>
        </div>
    </div>
</div>

<style>
.setup-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    opacity: 0.4;
    transition: opacity 0.3s;
}

.setup-step.active {
    opacity: 1;
}

.setup-step.completed {
    opacity: 0.7;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--term-surface-2);
    border: 2px solid var(--term-border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 16px;
    color: var(--text-muted);
    transition: all 0.3s;
}

.setup-step.active .step-number {
    background: var(--brand-primary);
    border-color: var(--brand-primary);
    color: #000;
    box-shadow: 0 0 0 4px rgba(122, 92, 255, 0.2);
}

.setup-step.completed .step-number {
    background: var(--brand-success);
    border-color: var(--brand-success);
    color: #000;
}

.step-label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.setup-step.active .step-label {
    color: var(--brand-primary);
}

.btn-lg {
    padding: 14px 32px;
    font-size: 15px;
}
</style>

<script>
let currentStep = 1;
const totalSteps = 7;

function showStep(step) {
    // Hide all steps
    document.querySelectorAll('.setup-content').forEach(content => {
        content.style.display = 'none';
    });
    
    // Show current step
    const currentContent = document.querySelector(`.setup-content[data-step="${step}"]`);
    if (currentContent) {
        currentContent.style.display = 'block';
    }
    
    // Update step indicators
    document.querySelectorAll('.setup-step').forEach((stepEl, index) => {
        stepEl.classList.remove('active', 'completed');
        if (index + 1 === step) {
            stepEl.classList.add('active');
        } else if (index + 1 < step) {
            stepEl.classList.add('completed');
        }
    });
    
    // Update navigation buttons
    document.getElementById('prevBtn').style.display = step > 1 ? 'block' : 'none';
    document.getElementById('nextBtn').textContent = step === totalSteps ? 'Finish ‚Üí' : 'Next ‚Üí';
    if (step === totalSteps) {
        document.getElementById('nextBtn').style.display = 'none';
    } else {
        document.getElementById('nextBtn').style.display = 'block';
    }
}

function nextStep() {
    if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
    }
}

function previousStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
    }
}

async function testPlex() {
    const statusDiv = document.getElementById('plexStatus');
    statusDiv.innerHTML = '<div class="alert alert-info">Testing Plex connection...</div>';
    
    try {
        const token = document.querySelector('[name="PLEX_TOKEN_MANUAL"]').value;
        const result = await API.post('/api/test/plex', { PLEX_TOKEN: token });
        statusDiv.innerHTML = `<div class="alert alert-success">‚úì Connected! Found ${result.user_count} users on server.</div>`;
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">‚úó Connection failed: ${error.message}</div>`;
    }
}

async function testTautulli() {
    const statusDiv = document.getElementById('tautulliStatus');
    statusDiv.innerHTML = '<div class="alert alert-info">Testing Tautulli connection...</div>';
    
    try {
        const url = document.querySelector('[name="TAUTULLI_URL"]').value;
        const apiKey = document.querySelector('[name="TAUTULLI_API_KEY"]').value;
        const result = await API.post('/api/test/tautulli', { TAUTULLI_URL: url, TAUTULLI_API_KEY: apiKey });
        statusDiv.innerHTML = `<div class="alert alert-success">‚úì Connected! Found ${result.user_count} users.</div>`;
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">‚úó Connection failed: ${error.message}</div>`;
    }
}

async function testEmail() {
    const statusDiv = document.getElementById('emailStatus');
    const email = document.querySelector('[name="ADMIN_EMAIL"]').value;
    
    if (!email) {
        statusDiv.innerHTML = '<div class="alert alert-danger">Please enter an admin email first</div>';
        return;
    }
    
    statusDiv.innerHTML = '<div class="alert alert-info">Sending test email...</div>';
    
    try {
        const formData = new FormData(document.getElementById('setupForm'));
        const config = {};
        for (let [key, value] of formData.entries()) {
            config[key] = value;
        }
        
        await API.post('/api/test/email', { ...config, email });
        statusDiv.innerHTML = `<div class="alert alert-success">‚úì Test email sent to ${email}. Check your inbox!</div>`;
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">‚úó Email failed: ${error.message}</div>`;
    }
}

async function testDiscord() {
    const statusDiv = document.getElementById('discordStatus');
    const webhook = document.querySelector('[name="DISCORD_WEBHOOK"]').value;
    
    if (!webhook) {
        statusDiv.innerHTML = '<div class="alert alert-danger">Please enter a webhook URL first</div>';
        return;
    }
    
    statusDiv.innerHTML = '<div class="alert alert-info">Sending test messages...</div>';
    
    try {
        const formData = new FormData(document.getElementById('setupForm'));
        const config = {};
        for (let [key, value] of formData.entries()) {
            config[key] = value;
        }
        
        await API.post('/api/test/discord', config);
        statusDiv.innerHTML = '<div class="alert alert-success">‚úì Test messages sent! Check your Discord channel.</div>';
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">‚úó Discord test failed: ${error.message}</div>`;
    }
}

async function previewImportUsers() {
    const statusDiv = document.getElementById('importStatus');
    const previewDiv = document.getElementById('importPreview');
    const userListDiv = document.getElementById('importUserList');
    const importBtn = document.getElementById('importBtn');
    
    statusDiv.innerHTML = '<div class="alert alert-info">Loading users from Plex...</div>';
    statusDiv.style.display = 'block';
    previewDiv.style.display = 'none';
    
    try {
        const response = await API.get('/api/users');
        const users = response;
        
        if (users.length === 0) {
            statusDiv.innerHTML = '<div class="alert alert-warning">No users found on your Plex server.</div>';
            return;
        }
        
        // Filter out users that would be imported (not already welcomed)
        const toImport = users.filter(u => u.status === 'new');
        const alreadyWelcomed = users.filter(u => u.status !== 'new');
        
        if (toImport.length === 0) {
            statusDiv.innerHTML = '<div class="alert alert-info">All users have already been welcomed. Nothing to import.</div>';
            importBtn.disabled = true;
            return;
        }
        
        // Show user list
        userListDiv.innerHTML = toImport.map(u => `
            <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid var(--term-border);">
                <div>
                    <div style="font-weight: bold; color: var(--text-primary);">${u.name}</div>
                    <div style="color: var(--text-muted); font-size: 11px;">${u.email || 'No email'}</div>
                </div>
                <span class="badge badge-info">New</span>
            </div>
        `).join('');
        
        statusDiv.innerHTML = `<div class="alert alert-success">Found ${toImport.length} user(s) to import${alreadyWelcomed.length > 0 ? `, ${alreadyWelcomed.length} already welcomed` : ''}.</div>`;
        previewDiv.style.display = 'block';
        importBtn.disabled = false;
        
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">Failed to load users: ${error.message}</div>`;
    }
}

async function importExistingUsers() {
    const statusDiv = document.getElementById('importStatus');
    const importBtn = document.getElementById('importBtn');
    
    importBtn.disabled = true;
    importBtn.textContent = 'Importing...';
    statusDiv.innerHTML = '<div class="alert alert-info">Importing users...</div>';
    statusDiv.style.display = 'block';
    
    try {
        const result = await API.post('/api/users/import');
        
        statusDiv.innerHTML = `
            <div class="alert alert-success">
                ‚úì Successfully imported ${result.total_imported} user(s)!
                ${result.total_skipped > 0 ? `<br>Skipped ${result.total_skipped} user(s) (already welcomed)` : ''}
            </div>
        `;
        
        // Auto-advance to next step after 2 seconds
        setTimeout(() => {
            nextStep();
        }, 2000);
        
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">Import failed: ${error.message}</div>`;
        importBtn.disabled = false;
        importBtn.textContent = '‚úì Import All Users';
    }
}

function skipImport() {
    nextStep();
}

async function completeSetup() {
    try {
        const formData = new FormData(document.getElementById('setupForm'));
        const config = {};
        
        for (let [key, value] of formData.entries()) {
            config[key] = value;
        }
        
        config.DRY_RUN = document.getElementById('dryRunCheckbox').checked ? 'true' : 'false';
        
        await API.post('/api/config', config);
        await API.post('/api/setup/complete', {});
        
        showAlert('Setup complete! Redirecting...', 'success');
        setTimeout(() => {
            window.location.href = '/';
        }, 1500);
    } catch (error) {
        showAlert(`Setup failed: ${error.message}`, 'error');
    }
}
}

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
    showStep(1);
    
    // Check if already authenticated with Plex via session
    try {
        console.log('Checking session...');
        const response = await fetch('/api/session/check');
        const data = await response.json();
        
        console.log('Session data:', data);
        
        if (data.authenticated && data.plex_token) {
            // User is logged in - pre-fill Plex credentials
            const tokenInput = document.querySelector('#plexAuthenticatedSection input[name="PLEX_TOKEN"]');
            const serverInput = document.querySelector('#plexAuthenticatedSection input[name="PLEX_SERVER_NAME"]');
            
            console.log('Setting token:', data.plex_token ? 'YES' : 'NO');
            console.log('Setting server:', data.server_name);
            
            tokenInput.value = data.plex_token;
            
            // Try to get server name from Plex API
            if (data.server_name) {
                serverInput.value = data.server_name;
            }
            
            document.getElementById('plexAuthenticatedSection').style.display = 'block';
            document.getElementById('plexManualSection').style.display = 'none';
            console.log('Showing authenticated section');
        } else {
            console.log('Not authenticated, showing manual section');
        }
    } catch (error) {
        console.log('Session check error:', error);
        console.log('Not authenticated via Plex OAuth, showing manual input');
    }
});
</script>
{% endblock %}
